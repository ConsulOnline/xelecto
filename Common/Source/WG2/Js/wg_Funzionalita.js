var fnglobalvariable={urlWgCarrello:'/carrello.asp',urlWgArticoliPreferitiAgente:'/agenti/agenti-preferiti.asp',urlWgArticoliPreferitiCliente:'/clienti/clienti-preferiti.asp',urlWgSediRegistra:'/Include/Clienti/SediRegistra.asp',urlWgReportCarrello:'/Report/ReportCarrelliClienti.asp',urlWgInsRapido:'/Clienti/Clienti-InserimentoRapido.asp',urlWgHtmlArticoli:'/Include/visualizzaArticoli.asp',urlWgHtmlTotaliDocumento:'/include/ordini/totalidocumento.asp',urlWgHtmlRigheCarrello:'/Include/Ordini/TabellaRigheDocumento.asp',urlWgHtmlDatiTestaCarrello:'/Include/Ordini/DatiTestaDocumento.asp',urlWgHtmlGestioneVoucherCarrello:'/Include/Ordini/GestioneVoucher.asp',urlWgHtmlConfrontoArticoli:'/Include/ConfrontoArticoli.asp',urlWgHtmlClientiRegistra:'/Include/Form/ClientiRegistra.asp',typeRTraduzioniLabelPagine:'TraduzioniLabelPagine',typeRloginClienteAgente:'loginClienteAgente',typeRDatiHtml:'datiHTML',typeRAggiungiArticoli:'AggiungiArticoli',typeRAggiungiPreferito:'AggiungiPreferito',typeREliminaPreferito:'EliminaPreferito',typeRsottoCategorie:'sottoCategorie',typeRduplicaCarrello:'duplicaCarrello',typeRsalvaSession:'salvaSession',typeRricalcola:'ricalcola',typeRcambioDatiTesta:'cambioDatiTesta',typeReliminaRigaDocumento:'eliminaRigaDocumento',typeRStampaMessaggio:'StampaMessaggio',typeRGestioneSede:'GestioneSede',typeRCreaOrdine:'CreaOrdine',typeRInserimentoMultiploArticoli:'InserimentoMultiploAticoli',typeRTrovaArticolo:'TrovaArticolo',typeRSalvaSession:'salvaSession',typeAggiungiPreventivoACarrello:'AggiungiPreventivoACarrello',typeSostituisciPreventivoACarrello:'SostituisciPreventivoACarrello',typeRDatoDB:'DatoDB',typeRDatoAgenteLoggato:'DatoAgenteLoggato',typeRGestioneVoucher:'GestioneVoucher',typeREliminaVoucher:'EliminaVoucher',typeRAnnullaPreventivo:'AnnullaPreventivo',typeRGetConfigurazioni:'GetConfigurazioni',cookieUserAge:'UsernameAge'}
function wg_AttivaLinkCarrello(param){if(jQuery('#wg_Carrello').length==1){if(typeof(param)=='undefined'){param={url:fnglobalvariable.urlWgCarrello}}jQuery('#wg_Carrello').on('click',function(e){location.href=param.url});}}function wg_CreaToolBarAgenti(){if($('#wg_ToolBarAgenti').length==1){wg_ServerRequest({async:true,variabili:{CodMessaggio:'TOOLBAR-AGENTI',typeRequest:fnglobalvariable.typeRStampaMessaggio}},function(response){$('#wg_ToolBarAgenti').html(response.Messaggio)});}}function wg_CreaToolBarClienti(){if(wg_VerificaReg()&&$('#wg_ToolBarClienti').length==1){wg_ServerRequest({async:true,variabili:{CodMessaggio:'TOOLBAR-CLIENTI',typeRequest:fnglobalvariable.typeRStampaMessaggio}},function(response){$('#wg_ToolBarClienti').html(response.Messaggio)});}}function wg_SelezionAttivaCliente(){WhereAgg=$('#wg_WhereAggListaRicerca').val();campo1=$('#wg_CampoRicerca').val();if(typeof(WhereAgg)=='undefined'){Response=wg_ServerRequest({async:false,UtenteAtt:'Agente',variabili:{typeRequest:fnglobalvariable.typeRDatoAgenteLoggato,campo:'CodAgente_AGE',}})
WhereAgg="CodAgente_CLAG='"+Response.Messaggio+"'";}wg_ApriListaRicerca({UtenteAtt:'Agente',parametri:{TabellaView:'ListView_ClientiAgenti',IdRiga:'CodCliente_CLI',WhereAgg:WhereAgg,CAMPO1:campo1},callback:wg_CallBackListaRicercaAttivaCliente});}function wg_SelezionaCarrelloSalvati(){wg_ApriListaRicerca({UtenteAtt:'Agente',parametri:{TabellaView:'ListView_CarrelliSalvati',IdRiga:'CodCliente_DOTE',WhereAgg:$('#wg_WhereAggListaRicerca').val()},callback:wg_CallBackListaRicercaAttivaCliente});}function wg_AttivaClienteAgente(param){if(typeof(param)=='object'&&param){wg_Loading(true);wg_ServerRequest({UtenteAtt:'Agente',async:true,variabili:{typeRequest:fnglobalvariable.typeRloginClienteAgente,CodCliente:param.valore}},function(response){wg_CallBackAttivaClienteAgente(param);});}}function wg_AggiornaCarrello(param){if(wg_VerificaReg()&&$('#wg_Carrello').length>0){wg_ServerRequest({UtenteAtt:'Cliente',variabili:{typeRequest:'datiHTML',tipoDato:'SituazioneCarrello',campiDati:'Totale_DOTE, NumTotRighe_DOTE, NumTotArt_DOTE'},async:true},function(response){wg_CallbackAggiornaCarrello(response);});}}function wg_GestioneEventiInsArtCar(param){if(typeof(param)=='undefined'){param={};param.selettorearticoli='#wg_ElencoArt';}if(wg_VerificaReg()){$(param.selettorearticoli).on('click','.wg_InsArtCar',function(e){var el=$(this);var contenitoreArt=$(this).parents('.wg_Articolo');var codArt=contenitoreArt.attr('data-articolo');var qta;if(contenitoreArt.find('.wg_Qta').val()!=''||typeof(param.noQta)=='undefined'){qta=contenitoreArt.find('.wg_Qta').val();}else{qta=1;}var varianti=[];$('input[name="varianti"]:checked').each(function(index,element){varianti.push($(this).val());});if(qta!=''&&qta>0){wg_Loading();wg_ServerRequest({UtenteAtt:'Cliente',async:true,variabili:{typeRequest:fnglobalvariable.typeRAggiungiArticoli,codArticolo:codArt,Qta:qta,Varianti:varianti.join(',')}},function(response){wg_AggiornaCarrello();wg_CallBackInsArtCar({CodArt:codArt});wg_LoadingClose();});}else{wg_Avviso('Attenzione inserire una quantità maggiore di 0.');}});}else{wg_Avviso('Cliente non attivato, non è possibile attivare l\' acquisto articoli');}}function wg_VisualizzaPreferiti(param){if(typeof(param)=='undefined'){param={};param.selettorearticoli='#wg_ElencoArt';}if(wg_VerificaReg()){wg_ServerRequest({async:true,variabili:{UtenteAtt:'Cliente',typeRequest:fnglobalvariable.typeRDatiHtml,tipoDato:'ArticoliPreferiti'},},function(requestPreferiti){wg_CallBackVisualizzaPreferiti({listapreferiti:requestPreferiti.Messaggio,selettorearticoli:param.selettorearticoli});});}else{wg_Avviso('Cliente non attivato, non è possibile attivare la gestione preferiti');}}function wg_GestioneEventiPreferiti(param){if(typeof(param)=='undefined'){param={};param.selettorearticoli='#wg_ElencoArt';}if(wg_VerificaReg()){$(param.selettorearticoli).on('click','.wg_ArtPreferito',function(){wg_Loading();var el=$(this);var id=$(this).parents('.wg_Articolo').attr('data-articolo');var iEl=el.find('i');var typeRequest=(iEl.hasClass('fa-heart-o'))?fnglobalvariable.typeRAggiungiPreferito:fnglobalvariable.typeREliminaPreferito
wg_ServerRequest({UtenteAtt:'Cliente',async:true,variabili:{typeRequest:typeRequest,CodArticolo:id}},function(requestAddPreferito){wg_LoadingClose();wg_CallBackClickPreferiti({tipoazione:typeRequest,selettore:iEl,});});});}else{wg_Avviso('Cliente non attivato, non è possibile attivare la gestione preferiti');}}function wg_GestioneEventiConfronto(param){if(typeof(param)=='undefined'){param={selettorearticoli:'#wg_ElencoArt'};}$(param.selettorearticoli).on('click','.wg_ConfrontoArt',function(){iEl=$(this).find('i')
if(iEl.hasClass('fa-square-o')){iEl.switchClass('fa-square-o','fa-check-square-o',0);}else{iEl.switchClass('fa-check-square-o','fa-square-o',0);}});$(param.selettorearticoli).on('click','.wg_Confronta',function(){if($('.wg_ConfrontoArt .fa-check-square-o').length>1){var ListaCodArt='';$('.wg_ConfrontoArt .fa-check-square-o').each(function(){if(ListaCodArt!='')ListaCodArt+='|';ListaCodArt+=$(this).parents('.wg_Articolo').attr('data-articolo');});wg_Loading();wg_ServerRequest({async:true,url:fnglobalvariable.urlWgHtmlConfrontoArticoli,variabili:{ListaCodArt:ListaCodArt}},function(response){wg_CallBackMostraConfronto({risposta:response});wg_LoadingClose();});}else{wg_Avviso({titolo:'Confronto Articoli',messaggio:wg_GetMessaggio({CodMessaggio:'CONFRONTO-MIN-2-ART'})});}});$('body').on('click','.wg_ChiudiConfronto',function(){param={selettore:$(this).parents('.wg_Articolo')}
wg_CallBackChiudiArtConfronto(param);});}function wg_VisualizzaArticoli(param){if(typeof(param)!='undefined'){if(typeof(param.selettorearticoli)=='undefined'){param.selettorearticoli='#wg_ElencoArt';}if(typeof(param.numpagcorrart)=='undefined'){param.numpagcorrart=1;}wg_Loading();$(param.selettorearticoli).hide('blind',function(e){el=$(this);el.empty();wg_ServerRequest({async:true,url:fnglobalvariable.urlWgHtmlArticoli,variabili:param},function(response){wg_CallBackVisualizzaArticoli({selettore:el,risposta:response})})});}else{wg_Avviso('Attenzione non hai inserito il selettore o la categoria per inserire l\' elenco articoli!');}}function wg_VisualizzaCategorie(param){if(typeof(param)!='undefined'){if(typeof(param.categoriaroot)=='undefined'){param.categoriaroot='ROOT';}if(typeof(param.categoriainiz)=='undefined'){param.categoriainiz='0001';}if(typeof(param.modVisual)=='undefined'){param.modVisual='Tab';}if(typeof(param.attivalink)=='undefined'){param.attivalink=false;}if(typeof(param.selettorecategorie)=='undefined'){param.selettorecategorie='#wg_ElencoCat';}if(!param.attivalink&&typeof(param.selettorearticoli)=='undefined'){param.selettorearticoli='#wg_ElencoArt';}wg_ServerRequest({async:true,variabili:{typeRequest:fnglobalvariable.typeRsottoCategorie,CodCategoriaPadre:param.categoriaroot,attivaLink:param.attivalink}},function(response){$(param.selettorecategorie).html(response.Messaggio);wg_GestioneEventiAlberoCategorie(param);});}else{wg_Avviso('Attenzione non hai inserito la categoriaroot o il selettore per la categoria.');}}function wg_GestioneEventiAlberoCategorie(param){if(!param.attivalink){$(param.selettorecategorie).on('click','li .descrizione',function(){categoriaSel=$(this);$('.descrizione.wg_CatSelected').removeClass('wg_CatSelected');categoriaSel.addClass('wg_CatSelected');wg_CallBackGestioneClickCategoria({selettore:categoriaSel,selettorearticoli:param.selettorearticoli,categoria:categoriaSel.parents('li').attr('id'),});});if(typeof(param.categoriainiz)!='undefined'&&param.categoriainiz!=''){$(param.selettorecategorie).find('li#'+param.categoriainiz+' .descrizione').addClass('wg_CatSelected');}}wg_InizializzaAlberoCategorie({areaAlberoCategoria:param.selettorecategorie,eventoSottocategorie:'click',attivaLink:param.attivalink});}function wg_GestioneClickProduttori(param){if(typeof(param.selettoreproduttori)=='undefined'){param={selettoreproduttori:'#wg_ElencoProd'}}if($(param.selettoreproduttori).length>0){$(param.selettoreproduttori).on('click','li .descrizione',function(){produttoreSel=$(this);$('.descrizione.wg_ProdSelected').removeClass('wg_ProdSelected');produttoreSel.addClass('wg_ProdSelected');wg_CallBackGestioneClickProduttore({selettore:produttoreSel,selettorearticoli:param.selettorearticoli,produttore:produttoreSel.parents('li').attr('id'),});});}}function wg_AggiungiDeselezione(param){htmldeseleziona='<i class="fa fa-times-circle right wg_Deseleziona pointer"></i>';if(typeof(param.htmldeseleziona)!='undefined'&&param.htmldeseleziona!=''){htmldeseleziona=param.htmldeseleziona;}lista=param.selettore.parents('.wg_lista');lista.find('.wg_Deseleziona').remove();param.selettore.append(htmldeseleziona);}function wg_GestioneClickDeseleziona(){$('.wg_lista').on('click','.wg_Deseleziona',function(e){e.stopPropagation();wg_Loading();wg_CallBackClickDeseleziona({selettore:$(this)})
$(this).remove();});}function wg_GestionePaginazioneArticoli(param){if(typeof(param.selettorearticoli)=='undefined'){param.selettorearticoli='#wg_ElencoArt';}$(param.selettorearticoli).on('click','.wg_LinkNumPag',function(e){e.stopPropagation();e.preventDefault();catSel=$('.descrizione.wg_CatSelected').parents('li').attr('id');wg_CallBackGestionePaginazioneArticoli({numpagcorrart:$(this).attr('data-pagina'),categoria:catSel});});}function wg_GestioneRimozionePaginazione(param){if(typeof(param.selettorearticoli)=='undefined'){param={selettorearticoli:'#wg_ElencoArt'}}$(param.selettorearticoli).on('click','.wg_NoPaginazione',function(e){wg_CallBackGestioneRimozionePaginazione();});}function wg_GestioneOrdinamento(param){if(typeof(param.selettorearticoli)=='undefined'){param={selettorearticoli:'#wg_ElencoArt'};}$(param.selettorearticoli).on('change','#wg_Ordinamento',function(){wg_CallBackGestioneOrdinamento({ordinamento:$(this).val()})});}function wg_GestioneModVisualArticoli(param){if(typeof(param.selettorearticoli)=='undefined'){param.selettorearticoli='#wg_ElencoArt';}$(param.selettorearticoli).on('click','#wg_toolModVis i',function(e){val='Tab';if($(this).attr('data-modvis')=='visTab')val='Tab';if($(this).attr('data-modvis')=='visBox')val='Box';if($(this).attr('data-modvis')=='visDet')val='Det';wg_ServerRequest({async:true,variabili:{typeRequest:fnglobalvariable.typeRSalvaSession,nomeSession:'modVisual',valoreSession:val}},function(){wg_CallbackGestioneModVisualArticoli(param);});});}function wg_InizializzaCatalogoEcommerce(param){if(typeof(param)!='undefined'){wg_GestioneEventiAlberoCategorie(param);wg_GestioneClickProduttori(param);if(param.gestmodvisual){wg_GestioneModVisualArticoli({selettorearticoli:param.selettorearticoli});}if(param.gestionepaginazione){wg_GestionePaginazioneArticoli({selettorearticoli:param.selettorearticoli,});wg_GestioneRimozionePaginazione({selettorearticoli:param.selettorearticoli});}if(param.gestioneconfronto){wg_GestioneEventiConfronto({selettorearticoli:param.selettorearticoli,});}if(param.gestioneordinamento){wg_GestioneOrdinamento({selettorearticoli:param.selettorearticoli,});}if(wg_VerificaReg()){if(param.gestionepreferiti){wg_VisualizzaPreferiti(param);wg_GestioneEventiPreferiti({selettorearticoli:param.selettorearticoli});}if(param.attivaacquisto){wg_GestioneEventiInsArtCar({selettorearticoli:param.selettorearticoli,noQta:param.gestioneinsartnoqta});wg_InserimentoMultiploArticoli({selettorearticoli:param.selettorearticoli})}}}else{wg_Avviso('Attenzione non hai inserito la categoriaroot o il selettore per la categoria o il selettore per gli articoli o la callback per la gestione del carrello');}}function wg_DuplicaOrdine(param){var idOrdine=param.idOrdine;wg_Avviso({titolo:'Carrello pieno',messaggio:'Vuoi sovrascrivere o aggiungere gli articoli al Carrello esistente?',buttons:{Sovrascrivi:function(){wg_Loading();wg_ServerRequest({UtenteAtt:'Cliente',variabili:{UtenteAtt:'Cliente',typeRequest:'duplicaCarrello',CodDocumento:idOrdine,tipoDuplica:'sovrascrivi'},async:true},function(data){location.href=fnglobalvariable.urlWgCarrello;});},Aggiungi:function(){wg_Loading();wg_ServerRequest({UtenteAtt:'Cliente',variabili:{UtenteAtt:'Cliente',typeRequest:'duplicaCarrello',CodDocumento:idOrdine,tipoDuplica:'aggiungi'},async:true},function(data){location.href=fnglobalvariable.urlWgCarrello;});}}});}function wg_AvvisoVisualizzaAllegatiOrdine(param){$('.wg_VisualizzaAllegatiOrdine').click(function(){wg_Loading();wg_ServerRequest({url:'/common/GestioneFile/VisualizzaFileWG2.asp',UtenteAtt:'Cliente',variabili:{Directory:param.Directory,attivaEliminazione:param.AttivaEliminazione}},function(response){wg_CallBackVisualizzaFile(response);})});if(param.AttivaEliminazione){$('#body').on('click','.wg_EliminaFile',function(e){var nf=$(this).attr('data-nomefile')
wg_Avviso({titolo:'Eliminazione file',messaggio:'Proseguendo eliminerete il file: Attenzione non sarà più possibile tornare indietro.',height:'auto',width:'auto',buttons:{Prosegui:function(){}}});});}}function wg_GestioneLingua(param){var visLinguaSel=false;if(typeof(param.VisualizzaLinguaSelezionata)!='undefined'){visLinguaSel=param.VisualizzaLinguaSelezionata;}if(!visLinguaSel&&wg_cookieGet('CodLingua')!=''){jQuery('.wg_Lingua[data-lingua="'+wg_cookieGet('CodLingua')+'"]').remove();}jQuery('.wg_Lingua').on('click',function(e){wg_Loading();codlingua=jQuery(this).attr('data-lingua');wg_ServerRequest({async:true,dataType:'json',variabili:{typeRequest:'salvaSession',NomeSession:'CodLingua',ValoreSession:codlingua}},function(response){if(response.Errore!=''){wg_LoadingClose();wg_Avviso(response.Messaggio);}else{wg_CallBackGestioneLingua({CodLingua:codlingua});wg_LoadingClose();}});});}function wg_AttivaToolBarCarrello(param){jQuery('#wg_ToolBar').find('.wg_Tool').on('click',function(){switch($(this).attr('data-tool')){case'ricalcola':wg_RicalcolaCarrello(param);break;case'procedi':if(wg_VerificaReg({Tipo:'UtenteAnonimo'})){wg_GestioneLoginRegistrazione();}else if(wg_VerificaReg()){wg_CreaOrdine(param);}break;case'svuota':location.href=fnglobalvariable.urlWgCarrello+'?__SVUOTA_CARRELLO=ok'
break;case'stampa':wg_OpenWin({Url:fnglobalvariable.urlWgReportCarrello,Nome:'StampaCarrello',Parametri:'toolbar=no,location=no,scrollbars=yes,resizable=yes'});break;case'insrapido':location.href=fnglobalvariable.urlWgInsRapido
break;}});}function wg_RicalcolaCarrello(param){var datiForm={};var campivalori;wg_Loading();if(typeof(param)!='undefined'&&typeof(param.FunzioneRicalcola)=='function'){param.FunzioneRicalcola(param.TotaleDocumento);}else{$('#wg_TabellaCarrello .wg_DocumentoRighe[data-tipo="ART"]').each(function(index,element){campivalori='';$(this).find('input,select').each(function(index,element){if(campivalori!='')campivalori+='|';var val='';var tipo=$(this).attr('type');switch(tipo.toLowerCase()){case'checkbox':if($(this).attr('data-campo-riga')=='CodTipoVendita_DORI'){val=($(this).is(':checked'))?'SC_MERCE':'MERCE';}else{val=($(this).is(':checked'))?'1':'0';}break;default:val=$(this).val();break;}campivalori=campivalori+$(this).attr('data-campo-riga')+':'+val;});datiForm[$(this).attr('data-idriga')]=campivalori;});datiForm['typeRequest']=fnglobalvariable.typeRricalcola;wg_ServerRequest({async:true,UtenteAtt:'Cliente',variabili:datiForm},function(response){wg_CallBackRicalcolaCarrello(response);});}}function wg_AggiungiArticoliCarrello(param){var datiForm={};var campivalori;wg_Loading();if(typeof(param)!='undefined'&&typeof(param.FunzioneRicalcola)=='function'){param.FunzioneAggiungiArticoliCarrello(param.TotaleDocumento);}else{$('#wg_TabellaCarrello .wg_AggiungiArticoloCarrello').each(function(index,element){campivalori='';$(this).find('input,select').each(function(index,element){if(campivalori!='')campivalori+='|';var val='';var tipo=$(this).attr('type');switch(tipo.toLowerCase()){case'checkbox':if($(this).attr('data-campo-riga')=='CodTipoVendita_DORI'){val=($(this).is(':checked'))?'SC_MERCE':'MERCE';}else{val=($(this).is(':checked'))?'1':'0';}break;default:val=$(this).val();break;}campivalori=campivalori+$(this).attr('data-campo-riga')+':'+val;});datiForm[$(this).attr('data-idriga')]=campivalori;});datiForm['typeRequest']=fnglobalvariable.typeRricalcola;wg_ServerRequest({async:true,UtenteAtt:'Cliente',variabili:datiForm},function(response){wg_CallBackAggiungiArticoliCarrello(response);});}}function wg_AggiornaTotali(param){wg_Loading();wg_ServerRequest({async:true,UtenteAtt:'Cliente',url:fnglobalvariable.urlWgHtmlTotaliDocumento,variabili:param},function(response){$('.wg_TotaliDoc').html(response);wg_LoadingClose();})}function wg_AggiornaRigheCarrello(param){wg_Loading();wg_ServerRequest({async:true,url:fnglobalvariable.urlWgHtmlRigheCarrello,UtenteAtt:'Cliente',variabili:param},function(response){$('#wg_DatiRigheCarrello').html(response);if($('.wg_datePicker').length>0){wg_InizializzaDatePicker();}wg_LoadingClose();})}function wg_AggiornaTestataCarrello(param){wg_Loading();wg_ServerRequest({async:true,url:fnglobalvariable.urlWgHtmlDatiTestaCarrello,UtenteAtt:'Cliente',variabili:param},function(response){$('#wg_DatiTestaCarrello').html(response);if($('.wg_datePicker').length>0){wg_InizializzaDatePicker();}wg_LoadingClose();})}function wg_AggiornaGestioneVoucherCarrello(param){wg_ServerRequest({async:true,url:fnglobalvariable.urlWgHtmlGestioneVoucherCarrello,UtenteAtt:'Cliente',variabili:param},function(response){$('#wg_GestioneVoucher').html(response);})}function wg_AttivaCambioDatiTesta(){$('#wg_DatiTestaCarrello').on('change','textarea.wg_AggiornaDocTesta,select.wg_AggiornaDocTesta,input[type="text"].wg_AggiornaDocTesta',function(){var el=$(this);wg_CambiaDatiTesta({campo:el.attr('data-campo-testa'),valore:el.val()});});wg_AttivaEventiSede();}function wg_CambiaDatiTesta(param){wg_Loading();wg_ServerRequest({async:true,UtenteAtt:'Cliente',variabili:{typeRequest:'cambioDatiTesta',campo:param.campo,valore:param.valore}},function(response){wg_CallBackCambioDatiTesta({risposta:response,campo:param.campo});});}function wg_AttivaEliminazioneRigaCarrello(){$('#wg_DatiRigheCarrello').on('click','.wg_EliminaRiga i',function(){var el=$(this).parents('.wg_DocumentoRighe');wg_Avviso({messaggio:wg_GetMessaggio({CodMessaggio:'EliminaRigaCarr'}),buttons:{'Ok':function(){wg_Loading();wg_ServerRequest({UtenteAtt:'Cliente',async:true,variabili:{typeRequest:fnglobalvariable.typeReliminaRigaDocumento,id:el.attr('data-idriga')}},function(response){wg_CallbackEliminaRigaCarrello({Elemento:el})
wg_LoadingClose();});},'Annulla':function(){wg_AvvisoClose();}}})})}function wg_GestioneFormSede(param){if(typeof(param)!='undefined'){wg_ServerRequest({url:fnglobalvariable.urlWgSediRegistra,UtenteAtt:'Cliente',variabili:{tipoazione:param.TipoAzione,codsede:param.CodSede},async:true},function(response){wg_Avviso({id:'AvvisoSede',width:600,height:800,titolo:'Gestione Sede',messaggio:response,responsive:true,},function(){var dati={typeRequest:fnglobalvariable.typeRGestioneSede,tipoazione:param.TipoAzione}
paramform={form:$('#wg_FrmSede'),formasyncsubmit:true,request:dati,callback:wg_CallBackGestioneSede}
wg_InizializzaForm(paramform);});});}}function wg_AttivaEventiSede(){if($('#wg_DatiTestaCarrello').length==1){if($('#wg_AttivaSede').length==1){$('#wg_DatiTestaCarrello').on('change','#wg_AttivaSede',function(){wg_Loading();param={typeRequest:fnglobalvariable.typeRGestioneSede,tipoazione:'AttivaSede',CodSede:$(this).val()}
wg_ServerRequest({UtenteAtt:'Cliente',variabili:param,async:true},function(){wg_CallBackCambioDatiTesta({risposta:'',campo:'CodSedeDest_DOTE'});wg_LoadingClose();});});}if($('#wg_AttivaSedeDoc').length==1){$('#wg_DatiTestaCarrello').on('change','#wg_AttivaSedeDoc',function(){wg_Loading();param={typeRequest:fnglobalvariable.typeRGestioneSede,tipoazione:'AttivaSedeDoc',CodSede:$(this).val()}
wg_ServerRequest({UtenteAtt:'Cliente',variabili:param,async:true},function(){wg_CallBackCambioDatiTesta({risposta:'',campo:'CodSedeDoc_DOTE'});wg_LoadingClose();});});}if($('#wg_AggiungiSede').length==1){$('#wg_DatiTestaCarrello').on('click','#wg_AggiungiSede',function(){param={TipoAzione:'AggiungiSede'}
wg_GestioneFormSede(param);})}}if($('.wg_ToolSedi').length>=1){$('#wg_AggiungiSede').on('click',function(){param={TipoAzione:'AggiungiSede'}
wg_GestioneFormSede(param);});$('.wg_ToolSedi').on('click','.wg_ModificaSede',function(){param={TipoAzione:'ModificaSede',CodSede:$(this).parents('.wg_Sede').attr('data-id')}
wg_GestioneFormSede(param);wg_CloseAvviso('AvvisoSede')});$('.wg_ToolSedi').on('click','.wg_GestDest',function(){var Selettore=$(this);var CodSede=Selettore.parents('.wg_Sede').attr('data-id');wg_Avviso({titolo:'Attiva sede Destinazione Merci',id:'avvisoAttivaSede',messaggio:'Vuoi attivare questa sede?',buttons:{Attiva:function(){param={typeRequest:fnglobalvariable.typeRGestioneSede,tipoazione:'AttivaSede',CodSede:CodSede}
wg_Loading();wg_ServerRequest({UtenteAtt:'Cliente',variabili:param,async:true},function(){wg_CallBackAttivaSede({CodSede:CodSede,Selettore:Selettore});wg_CloseAvviso('avvisoAttivaSede');wg_LoadingClose();});},Annulla:function(){wg_CloseAvviso('avvisoAttivaSede')}}});});$('.wg_ToolSedi').on('click','.wg_GestDoc',function(){var Selettore=$(this);var CodSede=Selettore.parents('.wg_Sede').attr('data-id');wg_Avviso({titolo:'Attiva sede destinazione Documenti',id:'avvisoAttivaSede',messaggio:'Vuoi attivare questa sede?',buttons:{Attiva:function(){param={typeRequest:fnglobalvariable.typeRGestioneSede,tipoazione:'AttivaSedeDoc',CodSede:CodSede}
wg_Loading();wg_ServerRequest({UtenteAtt:'Cliente',variabili:param,async:true},function(){wg_CallBackAttivaSede({CodSede:CodSede,Selettore:Selettore});wg_CloseAvviso('avvisoAttivaSede');wg_LoadingClose();});},Annulla:function(){wg_CloseAvviso('avvisoAttivaSede')}}});});$('.wg_EliminaSede').click(function(){var Selettore=$(this);var CodSede=Selettore.parents('.wg_Sede').attr('data-id');wg_Avviso({Titolo:'Eliminazione sede',id:'avvisoElimina',messaggio:'Sei sicuro di voler eliminare la sede?',buttons:{Elimina:function(){param={typeRequest:fnglobalvariable.typeRGestioneSede,tipoazione:'EliminaSede',CodSede:CodSede};wg_Loading();wg_ServerRequest({UtenteAtt:'Cliente',variabili:param,async:true},function(){wg_CallBackEliminaSede({CodSede:CodSede,Selettore:Selettore})
wg_CloseAvviso('AvvisoSede');wg_LoadingClose();});},Annulla:function(){wg_CloseAvviso('avvisoElimina')}}});});}}function wg_CreaOrdine(param){if(typeof(param)!='undefined'){var TotaleDocumento=0;if(typeof(param.TotaleDocumento)!='undefined'&&param.TotaleDocumento!='')TotaleDocumento=param.TotaleDocumento;if(TotaleDocumento>0){wg_Avviso({id:'avvisoChiusuraOrdine',titolo:'Confermi la chiusura dell\'Ordine?',messaggio:'Cliccando su prosegui l\'ordine verrà confermato e poi evaso.',width:400,buttons:{Prosegui:function(){wg_CloseAvviso('avvisoChiusuraOrdine');wg_Loading();if(typeof(param.FunzioneCreaOrdine)=='function'){param.FunzioneCreaOrdine(param.TotaleDocumento);}else{wg_NascondiConferma();wg_ScriviOrdine();}},Annulla:function(){wg_CloseAvviso('avvisoChiusuraOrdine');}}});}else{wg_Avviso({titolo:'Attenzione!',messaggio:'Non è possibile completare un ordine con il totale a zero'});}}}function wg_NascondiConferma(){var buttConferma=$('#wg_ToolBar div:last-child');buttConferma.html('<div class="small-8 medium-4 columns text-center end pointer">'+'<i class="fa fa-spinner fa-3x fa-pulse fa-fw"></i><br>Elaborazione in corso...</div>');}function wg_ScriviOrdine(){wg_ServerRequest({UtenteAtt:'Cliente',variabili:{typeRequest:fnglobalvariable.typeRCreaOrdine},async:true},function(response){data=response.Messaggio;if(!data.online){wg_CallBackScriviOrdine(data);wg_LoadingClose();}else{wg_ServerRequest({async:true,variabili:{UtenteAtt:'Cliente',typeRequest:'spedisciOrdine',CodOrdine:data.codordine}},function(response){switch(data.tipopagamento){case'CARTA_DI_CREDITO_PAYPAL':messaggio='L\'ordine è stato salvato correttamente. Clicca prosegui per completare il pagamento con PayPal.';url='/Pagamenti/pagapaypal.asp?CodOrdine='+data.codordine
break;case'UNICREDIT':messaggio='L\'ordine è stato salvato correttamente. Clicca prosegui per completare il pagamento con Carta di Credito.';url='/Pagamenti/PagamentiOnline.asp?__EFFETTUA_PAGAMENTO_ONLINE=OK&CodOrdine='+data.codordine
break;default:messaggio='L\'ordine è stato salvato correttamente. Clicca prosegui per completare il pagamento con PayPal.';url='/Pagamenti/pagapaypal.asp?CodOrdine='+data.codordine
break;}wg_LoadingClose();wg_Avviso({id:'avvisoPaypal',titolo:'Pagamento con Carta di Credito',messaggio:messaggio,width:400,heigth:300,buttons:{Prosegui:function(){location.href=url}}});});}});}function wg_IniziliazzaCarrello(param){wg_AttivaToolBarCarrello(param);wg_InizializzaInserimentoRapdio();wg_AttivaEliminazioneRigaCarrello();wg_AttivaCambioDatiTesta();wg_AttivaForzaturaPrezzo();wg_AttivaGestioneVoucher();}function wg_GestioneLoginRegistrazione(){wg_Avviso({id:'wg_AvvisoLoginRegistrazione',titolo:'Avanzamento Ordine',messaggio:wg_GetMessaggio({CodMessaggio:'Avviso-LoginRegistrazione'}),width:500,height:'auto'},function(){$('#wg_LoginRegistrazione').on('click','#wg_Logincli',function(e){wg_CloseAvviso('wg_AvvisoLoginRegistrazione');wg_Login({labelClienteAtt:'Area Clienti',labelLoginCliente:'Accesso Clienti',loginCliente:true,redirectCli:'/Carrello.asp',pswsmarritaCli:true});});$('#wg_LoginRegistrazione').on('click','#wg_Registrati',function(e){wg_CloseAvviso('wg_AvvisoLoginRegistrazione');wg_Avviso({titolo:' ',id:'wg_AvvisoRegistrazione',messaggio:{url:fnglobalvariable.urlWgHtmlClientiRegistra,},width:800,height:500,responsive:true});wg_InizializzaDatePicker();wg_InizializzaRegistrazioneCliente({TipoRegistrazione:'RegistraCliente'})});});}function wg_AttivaGestioneVoucher(){if($('#wg_GestioneVoucher').length>0){$('#wg_GestioneVoucher').on('click','#wg_InserimentoVoucher',function(){if($('#wg_InputVoucher').val()!=''){wg_Loading();wg_ServerRequest({async:true,UtenteAtt:'Cliente',variabili:{typeRequest:fnglobalvariable.typeRGestioneVoucher,CodVoucher:$('#wg_InputVoucher').val(),CodOrdine:$(this).attr('data-ordine')}},function(response){wg_CallBackGestioneVoucher();wg_LoadingClose();})}else{wg_Avviso({titolo:'Gestione Voucher',messaggio:wg_GetMessaggio({CodMessaggio:'ERRORE_NOCOD_VOUCHER'})});}});$('#wg_GestioneVoucher').on('click','.wg_EliminaVoucher',function(){el=$(this).parents('.wg_Voucher');wg_Avviso({messaggio:wg_GetMessaggio({CodMessaggio:'ELIMINA_VOUCHER'}),buttons:{'Ok':function(){wg_Loading();wg_ServerRequest({UtenteAtt:'Cliente',async:true,variabili:{typeRequest:fnglobalvariable.typeREliminaVoucher,CodVoucher:el.attr('data-voucher'),CodOrdine:el.attr('data-ordine')}},function(response){wg_CallbackEliminaVoucher({Elemento:el})
wg_LoadingClose();});},'Annulla':function(){wg_AvvisoClose();}}})});}}function wg_AttivaForzaturaPrezzo(){$('#wg_DatiRigheCarrello').on('change','input[data-campo-riga="NonAggiornaPrz_DORI"]',function(){if($(this).is(':checked')){$(this).parents('.wg_DocumentoRighe').find('input[data-campo-riga="PrezzoUnitario_DORI"]').removeAttr('disabled');}else{$(this).parents('.wg_DocumentoRighe').find('input[data-campo-riga="PrezzoUnitario_DORI"]').attr('disabled','disabled');}});}function wg_InizializzaInserimentoRapdio(){$('.wg_CercaArticoli i').on('click',function(){$('.wg_InsArticolo').removeClass('wg_ClickLente');RigaArticolo=$(this).parents('.wg_InsArticolo');RigaArticolo.addClass('wg_ClickLente');parametri={TabellaView:'ListView_Articoli',IdRiga:'CodArticolo_ART',}
if(RigaArticolo.find('.wg_CodArticolo').val()!=''){parametri.CAMPO1='CodArticolo_ART';parametri.CHIAVE1=RigaArticolo.find('.wg_CodArticolo').val();parametri.OPERATORE1='LIKE';}param={UtenteAtt:'Cliente',parametri:parametri,titolo:'Cerca Articoli',width:1200,callback:wg_CallBackListaRicercaInsRapido}
wg_ApriListaRicerca(param);});$('.wg_InsMultiploArt').on('click',function(e){if(_wg_VerificaQtaInsRapido()){var DatiForm={};wg_Loading();$('.wg_InsArticolo').each(function(index,element){if($(this).find('.wg_CodArticolo').val()!=''&&$(this).find('.wg_Qta').val()>0){var varianti=(typeof($(this).find('.wg_Varianti').val())=='undefined'?'':$(this).find('.wg_Varianti').val());DatiForm[index]=$(this).find('.wg_CodArticolo').val()+'#'+varianti+'#'+$(this).find('.wg_Qta').val();}});DatiForm['typeRequest']=fnglobalvariable.typeRInserimentoMultiploArticoli;wg_ServerRequest({async:true,UtenteAtt:'Cliente',variabili:DatiForm},function(){$('.wg_InsArticolo input').val('');if(typeof(wg_CallBackInserimentoRapido)=='function'){wg_CallBackInserimentoRapido({});}wg_AggiornaCarrello();wg_LoadingClose();});}});}function _wg_VerificaQtaInsRapido(){risp=true;$('.wg_InsArticolo').each(function(index,element){if($(this).find('.wg_CodArticolo').val()!=''&&(isNaN($(this).find('.wg_Qta').val())||$(this).find('.wg_Qta').val()==''||$(this).find('.wg_Qta').val()<=0)){$(this).find('.wg_Qta').focus();wg_Avviso({id:'wg_AvvisoQtaNulla',titolo:'Avviso Inserimento',messaggio:'Inserire una Quantità maggiore di zero',buttons:{OK:function(){wg_CloseAvviso('wg_AvvisoQtaNulla');}}});risp=false;return false;}});return risp;}function wg_PosizionamentoImmaginiArticoli(){var $divImg=$('.wg_ImgArtBox'),$img=$divImg.find('img');if($divImg.length>0){$img.each(function(index,element){$(this).position({my:'center center',at:'center center',of:$(this).parent()})});$(window).load(function(){$img.each(function(index,element){$(this).position({my:'center center',at:'center center',of:$(this).parent()})});})}}function wg_AutocompletamentoRicerca(param){if(typeof(param)=='undefined'){param={selettore:'.wg_AutoCompletamento',url:globalvariable.urlWgRequest,Tipo:'Articoli'};}$(param.selettore).autocomplete({minLength:2,source:function(request,response){var codverifica=wg_CreaCodiceVerifica();wg_cookieSet('CodVerificaAccesso',codverifica,'','','',false);$.ajax({type:'POST',async:true,url:param.url,data:{CodVerifica:codverifica,Tipo:param.Tipo,typeRequest:'AutoCompletamento',Chiave:request.term},success:function(data){response(data.Messaggio.Array);}});},select:function(event,ui){wg_CallBackAutoCompletamento({selezione:ui,evento:event,elemento:this});}});}function wg_CaricaCarrelloDaPreventivo(param){var idPreventivo=param.idPreventivo;if(typeof(param)!='undefined'){wg_Avviso({id:'avvisoCaricaCarrelloDaPreventivo',titolo:'Gestione Preventivo',messaggio:'Selezionare il metodo di caricamento del preventivo nel carrello.',width:400,buttons:{Aggiungi:function(){wg_CloseAvviso('avvisoCaricaCarrelloDaPreventivo');wg_Loading();if(typeof(param.FunzioneCreaOrdine)=='function'){param.FunzioneCaricaCarrello();}else{wg_CaricaCarrello(idPreventivo,true);}},Sostituisci:function(){wg_CloseAvviso('avvisoCaricaCarrelloDaPreventivo');wg_Loading();if(typeof(param.FunzioneCreaOrdine)=='function'){param.FunzioneCaricaCarrello();}else{wg_CaricaCarrello(idPreventivo,false);}},Annulla:function(){wg_CloseAvviso('avvisoCaricaCarrelloDaPreventivo');}}});}else{wg_Avviso({titolo:'Attenzione!',messaggio:'Non è possibile caricare il preventivo.'});}}function wg_CaricaCarrello(idPreventivo,aggiungi){if(typeof aggiungi==='undefined')aggiungi=true;var strTypeRequest;strTypeRequest=fnglobalvariable.typeAggiungiPreventivoACarrello;if(!aggiungi)strTypeRequest=fnglobalvariable.typeSostituisciPreventivoACarrello;wg_ServerRequest({UtenteAtt:'Cliente',variabili:{typeRequest:strTypeRequest,CodDocumento:idPreventivo},async:true},function(response){data=response.Messaggio;wg_CallBackCaricaCarrello();wg_LoadingClose();});}function wg_AnnullaPreventivo(param){var TipoAzione;if(typeof(param)!='undefined'&&typeof(param.idPreventivo)!='undefined'){if(typeof(param.TipoAzione)=='undefined'){TipoAzione='ANNULLA_PREVENTIVO_CLIENTE';}else{TipoAzione=param.TipoAzione;}wg_Avviso({id:'avvisoAnnullaPreventivo',titolo:'Annullamento Preventivo',messaggio:'Cliccando su prosegui il preventivo verrà annullato.',width:400,buttons:{Prosegui:function(){wg_Loading();wg_ServerRequest({UtenteAtt:'Cliente',variabili:{typeRequest:fnglobalvariable.typeRAnnullaPreventivo,CodDocumento:param.idPreventivo,TipoAzione:param.TipoAzione},async:true},function(response){wg_CallBackAnnullaPreventivo({idPreventivo:param.idPreventivo});});},Annulla:function(){wg_CloseAvviso('avvisoAnnullaPreventivo');}}})}}function wg_InizializzaRegistrazioneCliente(param){paramform={form:$('#wg_FrmRegistrazioneCliente'),formasyncsubmit:true,request:{typeRequest:param.TipoRegistrazione},callback:wg_CallBackRegistrazioneCliente}
wg_InizializzaForm(paramform);}function wg_InserimentoMultiploArticoli(param){if(typeof(param)=='undefined'){param={};param.selettorearticoli='#wg_ElencoArt';}if(wg_VerificaReg()){$(param.selettorearticoli).on('click','.wg_InserimentoMultiplo',function(){wg_Loading();var DatiForm={};$('.wg_Qta').each(function(index,element){if($(this).parents('.wg_Articolo').attr('data-articolo')!=''&&!isNaN($(this).val())&&$(this).val()>=0){var varianti=(typeof($(this).find('.wg_Varianti').val())=='undefined'?'':$(this).find('.wg_Varianti').val());DatiForm[index]=$(this).parents('.wg_Articolo').attr('data-articolo')+'#'+varianti+'#'+$(this).val();}});DatiForm['typeRequest']=fnglobalvariable.typeRInserimentoMultiploArticoli;wg_ServerRequest({async:true,UtenteAtt:'Cliente',variabili:DatiForm},function(){$('.wg_Qta').val('');wg_AggiornaCarrello();wg_CallBackInserimentoMultiploArticoli();wg_LoadingClose();});});}else{wg_Avviso('Cliente non attivato, non è possibile attivare l\' acquisto articoli');}}